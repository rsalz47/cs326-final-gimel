<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <title>Fizzy</title>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <base href="/src/frontend/" />
    <script type="module" src="js/dashboard.js"></script>
	</head>
    
	<body>
        <script id="navbar" src="js/nav.js"></script>

        <div class="row">
            <link rel="stylesheet" href="css/notes.css">
            
            <script type="module" id="notes_script" src="js/notes.js"></script>


            <div class="col-md-3 solid-black-border-right" id="view1">
                <div class="notes-listing">
                    <ul id='notes'></ul>
                </div>
                <input class="mytext" id="cur_note" placeholder="Type a message!"/>
                <script>
                    /// Register event listener to send the note when the enter key is pressed
                    document.getElementById("cur_note").addEventListener("keydown", event => {
                        if (event.keyCode === 13) {
                            send_note();
                        }
                    });
                </script>
                <input type='button' onClick="send_note()" value="Send">
            </div>

            
            <div class="col-md-6" id="view2">
              <table class="table table-hover">
                  <thead>
                  <tr>
                    <th scope="col">Role</th>
                    <th scope="col">Name</th>
                    <th scope="col">Handle</th>
                  </tr>
                </thead>
                <tbody id="user_table">
                </tbody>
              </table> 

              <br>
              <br>

              <table class="table table-hover" id="project_table">
                <thead>
                  <tr>
                    <th scope="col">Project</th>
                    <th scope="col">Fuzzer</th>
                    <th scope="col">Target</th>
                    <th scope="col">Input_Dir</th>
                    <th scope="col">Output_Dir</th>
                    <th scope="col">Timestamp</th>
                  </tr>
                </thead>
                <script type="module">
                  import {get_project_rows} from "./js/client.js";
                    const my_tables = await get_project_rows();
                    my_tables.forEach(project => {
                        const table = document.getElementById("project_table");
                        const tr = table.insertRow();
                        tr.insertCell().appendChild(document.createTextNode(project.name));
                        tr.insertCell().appendChild(document.createTextNode(project.fuzzer));
                        tr.insertCell().appendChild(document.createTextNode(project.target));
                        tr.insertCell().appendChild(document.createTextNode(project.input_dir));
                        tr.insertCell().appendChild(document.createTextNode(project.output_dir));
                        tr.insertCell().appendChild(document.createTextNode(project.time_stamp));
                    });
                </script>
              </table>
              <input type="text" id="project_name" placeholder="project-name">
              <input type="text" id="fuzzer_name" placeholder="fuzzer-name">
              <input type="text" id="bin_path" placeholder="target-binary-path">
              <input type="text" id="in_dir" placeholder="fuzzer-input-dir">
              <input type="text" id="out_dir" placeholder="fuzzer-output-dir">
              <button type="button" class="btn btn-primary" data-dismiss="modal" 
                  id="project_submit">Submit</button>

                <script type="module">
                  import {init_project} from "./js/client.js";
                  /// Register event listener to add a project when submit button is hit
                  document.getElementById("project_submit").addEventListener("click", () => {
                    let project = {};
                    const ts = new Date();

                    project.name       = document.getElementById("project_name").value;
                    project.fuzzer     = document.getElementById("fuzzer_name").value;
                    project.target     = document.getElementById("bin_path").value;
                    project.input_dir  = document.getElementById("in_dir").value;
                    project.output_dir = document.getElementById("out_dir").value;
                    project.time_stamp = ts.toLocaleDateString();

                    init_project(project);
                  });
              </script>
            </div>

            <div class="col-md-2" id="view2">
              <table class="table table-hover" id="stat_table">
                <thead>
                  <tr>
                    <th scope="col"></th>
                    <th scope="col"></th>
                  </tr>
                </thead>
              </table>
            </div>
        </div>
        <script type="module">
          import {getAllComments} from "./js/client.js";
          function loadHomepage() {
            document.getElementById("notes").innerHTML = '';
            getAllComments();
          }
          loadHomepage()
          setInterval(loadHomepage, 1000 * 2)
        </script>
	</body>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

</html>
