<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />

    <title>Bootstrap Tutorial Sample Page</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="editor.css" />
  </head>

  <body>
    <script id="navbar" src="src/frontend/nav.js"></script>
    <div id="editor"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/loader.min.js"></script>
    <script>
      require.config({
        paths: {
          vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/",
        },
      });
      window.MonacoEnvironment = {
        getWorkerUrl: function (workerId, label) {
          return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
            self.MonacoEnvironment = { baseUrl: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/" };
            importScripts("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/base/worker/workerMain.min.js");`)}`;
        },
      };
      require(["vs/editor/editor.main"], async function () {
        // Create the editor with some sample JavaScript code
        var editor = monaco.editor.create(document.getElementById("editor"), {
          value: await fetch(
            "https://raw.githubusercontent.com/llvm/llvm-project/main/llvm/lib/CodeGen/Analysis.cpp"
          ).then((s) => s.text()),
          language: "cpp",
          inlayHints: {
            enabled: true,
          },
          theme: "vs-dark",
        });

        // Resize the editor when the window size changes
        const editorElement = document.getElementById("editor");
        window.addEventListener("resize", () =>
          editor.layout({
            width: editorElement.offsetWidth,
            height: editorElement.offsetHeight,
          })
        );
        // TODO: Seperate this part to automatically parse
        const model = monaco.editor.getModels()[0];
        model.deltaDecorations(model.getAllDecorations(), [
          {
            range: new monaco.Range(89, 0, 99, 0),
            options: {
              isWholeLine: true,
              marginClassName: "markup-1",
              className: "markup-1",
              hoverMessage: {
                supportHtml: true,
                value:
                  "<img src='https://avatars.githubusercontent.com/u/23451424?v=4'" +
                  " width='50' align='right'/>\n\n" +
                  Date() +
                  "\n\n" +
                  "By [_dungwinux_](https://github.com/dungwinux/):\n\n" +
                  "We should fuzz this part and check coverage.",
              },
            },
          },
          {
            range: new monaco.Range(102, 0, 109, 0),
            options: {
              isWholeLine: true,
              marginClassName: "markup-2",
              className: "markup-2",
              hoverMessage: {
                supportHtml: true,
                value:
                  "" +
                  Date() +
                  "\n\n" +
                  "By [_seal9055_](https://github.com/seal9055/):\n\n" +
                  "This one too",
              },
            },
          },
        ]);
      });
    </script>
  </body>

  <script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"
  ></script>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
    crossorigin="anonymous"
  ></script>
</html>
